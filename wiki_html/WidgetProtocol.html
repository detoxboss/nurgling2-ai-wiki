<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>WidgetProtocol</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">WidgetProtocol</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#widgets-and-the-server-protocol">Widgets and the server
protocol</a>
<ul>
<li><a href="#rname-factories"><code>@RName</code> factories</a></li>
<li><a href="#wdgmsg-vs-uimsg"><code>wdgmsg</code> vs
<code>uimsg</code></a></li>
<li><a href="#examples-in-nurgling">Examples in Nurgling</a>
<ul>
<li><a href="#intercepting-item-actions">Intercepting item
actions</a></li>
<li><a href="#custom-inventory-gestures">Custom inventory
gestures</a></li>
<li><a href="#world-interaction-messages">World interaction
messages</a></li>
</ul></li>
<li><a href="#finding-widgets-at-runtime">Finding widgets at
runtime</a></li>
</ul></li>
</ul>
</nav>
<h1 id="widgets-and-the-server-protocol">Widgets and the server
protocol</h1>
<h2 id="rname-factories"><code>@RName</code> factories</h2>
<p>The server sends widget-creation commands that refer to a symbolic
widget name. On the client side:</p>
<ul>
<li>Classes are annotated with <code>@RName("...")</code></li>
<li>A nested <code>public static class $_ implements Factory</code>
provides <code>create(UI ui, Object[] args)</code></li>
</ul>
<p>Nurgling modifies several <code>haven</code> factories to instantiate
Nurgling subclasses. This is how <code>NGameUI</code>,
<code>NMapView</code>, <code>NInventory</code>, <code>NGItem</code>, and
<code>NFlowerMenu</code> become the live objects without needing server
changes.</p>
<h2 id="wdgmsg-vs-uimsg"><code>wdgmsg</code> vs <code>uimsg</code></h2>
<ul>
<li><strong>Client → server</strong>: <code>wdgmsg("...")</code> sends a
command for this widget.</li>
<li><strong>Server → client</strong>: <code>uimsg("...")</code> delivers
state updates.</li>
</ul>
<p>A useful rule of thumb:</p>
<ul>
<li>if you are trying to <em>perform an action</em>, it will be a
<code>wdgmsg</code> (e.g., <code>"click"</code>, <code>"itemact"</code>,
<code>"take"</code>).</li>
<li>if you are trying to <em>react to server state</em>, you
implement/override <code>uimsg</code>.</li>
</ul>
<h2 id="examples-in-nurgling">Examples in Nurgling</h2>
<h3 id="intercepting-item-actions">Intercepting item actions</h3>
<p><code>nurgling.NGItem.wdgmsg(...)</code> intercepts
<code>"take"</code> and <code>"iact"</code> to record the candidate item
name into <code>NCharacterInfo</code>.</p>
<h3 id="custom-inventory-gestures">Custom inventory gestures</h3>
<p><code>nurgling.NWItem.mousedown(...)</code> adds modifier-based
actions:</p>
<ul>
<li>Alt+Shift+Click:
<code>wdgmsg("transfer-same", item, ascending)</code></li>
<li>Alt+Ctrl+Click:
<code>wdgmsg("drop-same", item, ascending)</code></li>
</ul>
<p>These messages are handled on the <strong>inventory widget</strong>
side, not the server, so they are an example of a <em>client-local
extension</em> pattern.</p>
<h3 id="world-interaction-messages">World interaction messages</h3>
<p><code>nurgling.NUtils</code> is the main “message helper” for world
interaction. Examples:</p>
<ul>
<li>click a gob:
<code>map.wdgmsg("click", ..., button=1, ..., gobid, ...)</code></li>
<li>right-click activate:
<code>map.wdgmsg("click", ..., button=3, flags=1, ...)</code></li>
<li>itemact on gob:
<code>map.wdgmsg("itemact", ..., gobid, ...)</code></li>
</ul>
<p>If you are writing automation, using <code>NUtils</code> is typically
preferable to constructing raw <code>wdgmsg</code> payloads
yourself.</p>
<h2 id="finding-widgets-at-runtime">Finding widgets at runtime</h2>
<p>Useful patterns already implemented in <code>NGameUI</code>:</p>
<ul>
<li><code>getWindow(String caption)</code> – returns the first matching
<code>Window</code>.</li>
<li><code>getWindows(String caption)</code> – returns all matching
windows.</li>
<li><code>getWindowWithButton(String cap, String button)</code> – locate
a window by caption that contains a specific <code>Button</code>
label.</li>
</ul>
<p>When adding new UI, using a stable window caption (or some other
stable widget ID) will make automation much more robust.</p>
</body>
</html>
